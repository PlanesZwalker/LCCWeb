<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maquette 3D - Letters Cascade Challenge</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎮</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/shared.css">
    <script src="js/utils.js"></script>
    <style>
        /* Enhanced 3D Game UI/UX - Professional Design */
        .page-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: var(--spacing-2xl);
            min-height: 100vh;
            max-width: 1800px;
            margin: 0 auto;
            padding: var(--spacing-xl);
        }



        .main-content {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-2xl);
        }

        /* Enhanced Game Header */
        .game-header {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.95));
            border-radius: var(--radius-2xl);
            padding: var(--spacing-2xl);
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .game-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 20%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(118, 75, 162, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .game-header h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: var(--spacing-lg);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .game-header p {
            color: var(--gray-600);
            font-size: 1.2rem;
            line-height: 1.7;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        /* Enhanced Game Container */
        .game-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.95));
            border-radius: var(--radius-2xl);
            padding: var(--spacing-2xl);
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: var(--spacing-xl);
            min-height: 600px;
            position: relative;
            overflow: hidden;
        }

        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
        }

        /* Enhanced Game Main Area */
        .game-main {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xl);
        }

        /* Enhanced Controls Section */
        .controls-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-xl);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(118, 75, 162, 0.08));
            border-radius: var(--radius-xl);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .controls-section h3 {
            color: var(--primary-color);
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: var(--spacing-md);
        }

        /* Enhanced Game Controls */
        .game-controls {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
            justify-content: center;
        }

        .game-controls .btn {
            padding: var(--spacing-md) var(--spacing-lg);
            font-size: 1rem;
            font-weight: 600;
            border-radius: var(--radius-lg);
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: var(--gray-700);
            min-width: 120px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .game-controls .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .game-controls .btn:hover::before {
            left: 100%;
        }

        .game-controls .btn:hover {
            background: rgba(102, 126, 234, 0.15);
            color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .game-controls .btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: var(--shadow-md);
        }

        /* Enhanced Configuration */
        .configuration {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .config-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .config-group label {
            color: var(--gray-700);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .config-buttons {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .config-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.9rem;
            font-weight: 600;
            border-radius: var(--radius-md);
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: var(--gray-700);
            cursor: pointer;
        }

        .config-btn:hover {
            background: rgba(102, 126, 234, 0.15);
            color: var(--primary-color);
            transform: translateY(-1px);
        }

        .config-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: var(--shadow-md);
        }

        /* Enhanced Game Grid Container */
        .game-grid-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            border-radius: var(--radius-xl);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: var(--spacing-lg);
            position: relative;
            overflow: hidden;
            min-height: 400px;
        }

        .game-grid-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        #gameGrid {
            width: 100%;
            height: 100%;
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 16px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
        }

        #gameGrid:hover {
            transform: scale(1.02);
            box-shadow: 0 16px 50px rgba(0, 0, 0, 0.5);
        }

        /* Enhanced Game Info */
        .game-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-lg);
            margin-top: var(--spacing-xl);
        }

        .info-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .info-section:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .info-section h4 {
            color: var(--gray-600);
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-section .value {
            color: var(--primary-color);
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Enhanced Score Display */
        .score-display {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            margin-top: var(--spacing-lg);
            border: 1px solid rgba(102, 126, 234, 0.2);
            text-align: center;
        }

        .score-display span {
            color: var(--gray-700);
            font-size: 1rem;
            font-weight: 600;
        }

        .score-display strong {
            color: var(--primary-color);
            font-size: 1.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Enhanced Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xl);
        }

        .sidebar-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .sidebar-section:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
        }

        .sidebar-section h3 {
            color: var(--primary-color);
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: var(--spacing-md);
        }

        .sidebar-section p {
            color: var(--gray-700);
            line-height: 1.7;
            margin-bottom: var(--spacing-md);
            font-size: 1rem;
        }

        .sidebar-section strong {
            color: var(--primary-color);
            font-weight: 700;
        }

        /* Enhanced Word List */
        .word-list {
            max-height: 200px;
            overflow-y: auto;
            padding: var(--spacing-md);
            background: rgba(102, 126, 234, 0.05);
            border-radius: var(--radius-md);
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .word-list li {
            padding: var(--spacing-sm) var(--spacing-md);
            margin-bottom: var(--spacing-xs);
            background: rgba(255, 255, 255, 0.8);
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--primary-color);
            transition: all 0.3s ease;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--gray-800);
        }

        .word-list li:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateX(5px);
            color: var(--primary-color);
        }

        .word-list li.completed {
            background: rgba(76, 175, 80, 0.1);
            border-left-color: var(--success-color);
            color: var(--success-color);
        }

        /* Enhanced Letter Queue */
        .letter-queue {
            margin-top: var(--spacing-lg);
        }

        .queue-display {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
            justify-content: center;
        }

        .queue-letter {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--radius-md);
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .queue-letter:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: var(--shadow-lg);
        }

        /* Enhanced Full Screen Styles */
        .game-container.fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 10000 !important;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            border-radius: 0 !important;
            padding: 2rem !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
        }

        .game-container.fullscreen .game-grid-container {
            flex: 1 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            width: 100% !important;
            height: 100% !important;
        }

        .game-container.fullscreen #gameGrid {
            width: 100% !important;
            height: 100% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        .game-container.fullscreen canvas {
            max-width: 90vw !important;
            max-height: 90vh !important;
            width: auto !important;
            height: auto !important;
            border: 3px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 16px !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5) !important;
        }

        .fullscreen-exit {
            position: absolute !important;
            top: 20px !important;
            right: 20px !important;
            width: 50px !important;
            height: 50px !important;
            background: rgba(0, 0, 0, 0.8) !important;
            color: white !important;
            border: none !important;
            border-radius: 50% !important;
            font-size: 20px !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 10001 !important;
            transition: all 0.3s ease !important;
        }

        .fullscreen-exit:hover {
            background: rgba(255, 255, 255, 0.2) !important;
            transform: scale(1.1) !important;
        }

        .game-container.fullscreen .game-controls {
            position: absolute !important;
            bottom: 20px !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            background: rgba(0, 0, 0, 0.8) !important;
            backdrop-filter: blur(20px) !important;
            border-radius: 12px !important;
            padding: 1rem 2rem !important;
            display: flex !important;
            gap: 1rem !important;
            z-index: 10001 !important;
        }

        .game-container.fullscreen .game-info {
            position: absolute !important;
            top: 20px !important;
            left: 20px !important;
            background: rgba(0, 0, 0, 0.8) !important;
            backdrop-filter: blur(20px) !important;
            border-radius: 12px !important;
            padding: 1rem 2rem !important;
            z-index: 10001 !important;
        }

        .game-container.fullscreen .sidebar {
            position: absolute !important;
            top: 20px !important;
            right: 20px !important;
            background: rgba(0, 0, 0, 0.8) !important;
            backdrop-filter: blur(20px) !important;
            border-radius: 12px !important;
            padding: 1rem 2rem !important;
            z-index: 10001 !important;
            max-width: 300px !important;
        }

        /* Full Screen Exit Button */
        .fullscreen-exit {
            position: fixed !important;
            top: 20px !important;
            right: 20px !important;
            width: 50px !important;
            height: 50px !important;
            background: rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(10px) !important;
            border: 2px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 50% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            cursor: pointer !important;
            z-index: 10000 !important;
            font-size: 1.5rem !important;
            color: white !important;
            transition: all 0.3s ease !important;
            animation: exitButtonAppear 0.5s ease-out 0.4s both !important;
        }

        @keyframes exitButtonAppear {
            from {
                opacity: 0;
                transform: scale(0.5) rotate(180deg);
            }
            to {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        .fullscreen-exit:hover {
            background: rgba(255, 255, 255, 0.2) !important;
            transform: scale(1.1) !important;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3) !important;
        }

        /* Full Screen Sidebar */
        .game-container.fullscreen .sidebar {
            position: fixed !important;
            right: 20px !important;
            top: 50% !important;
            transform: translateY(-50%) !important;
            width: 300px !important;
            max-height: 80vh !important;
            background: rgba(0, 0, 0, 0.8) !important;
            backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 16px !important;
            padding: 1.5rem !important;
            overflow-y: auto !important;
            z-index: 10001 !important;
            animation: sidebarSlideIn 0.6s ease-out 0.5s both !important;
        }

        @keyframes sidebarSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50%) translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateY(-50%) translateX(0);
            }
        }

        .game-container.fullscreen .sidebar-section {
            background: rgba(255, 255, 255, 0.05) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            border-radius: 12px !important;
            padding: 1rem !important;
            margin-bottom: 1rem !important;
            transition: all 0.3s ease !important;
        }

        .game-container.fullscreen .sidebar-section:hover {
            background: rgba(255, 255, 255, 0.08) !important;
            transform: translateX(-5px) !important;
        }

        .game-container.fullscreen .sidebar-section h3 {
            font-size: 1.1rem !important;
            margin-bottom: 0.75rem !important;
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .game-container.fullscreen .sidebar-section p {
            font-size: 0.9rem !important;
            line-height: 1.5 !important;
            color: rgba(255, 255, 255, 0.7) !important;
        }

        /* Full Screen Word List */
        .game-container.fullscreen .word-list {
            max-height: 200px !important;
            overflow-y: auto !important;
        }

        .game-container.fullscreen .word-list li {
            padding: 0.5rem 0.75rem !important;
            margin-bottom: 0.5rem !important;
            font-size: 0.9rem !important;
            transition: all 0.3s ease !important;
        }

        .game-container.fullscreen .word-list li:hover {
            background: rgba(102, 126, 234, 0.2) !important;
            transform: translateX(5px) !important;
        }

        /* Full Screen Letter Queue */
        .game-container.fullscreen .letter-queue {
            margin-top: 1rem !important;
        }

        .game-container.fullscreen .queue-display {
            display: flex !important;
            gap: 0.5rem !important;
            flex-wrap: wrap !important;
        }

        .game-container.fullscreen .queue-letter {
            width: 40px !important;
            height: 40px !important;
            font-size: 1.2rem !important;
            transition: all 0.3s ease !important;
        }

        .game-container.fullscreen .queue-letter:hover {
            transform: scale(1.1) !important;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3) !important;
        }

        /* Responsive Full Screen */
        @media (max-width: 1200px) {
            .game-container.fullscreen .controls-section {
                flex-direction: column !important;
                gap: 1rem !important;
            }
            
            .game-container.fullscreen .sidebar {
                width: 250px !important;
            }
        }

        @media (max-width: 768px) {
            .game-container.fullscreen .game-header h1 {
                font-size: 1.5rem !important;
            }
            
            .game-container.fullscreen .controls-section {
                padding: 0.75rem 1rem !important;
            }
            
            .game-container.fullscreen .game-info {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 1rem !important;
            }
            
            .game-container.fullscreen .sidebar {
                position: static !important;
                width: 100% !important;
                max-height: none !important;
                transform: none !important;
                margin-top: 1rem !important;
            }
            
            .game-container.fullscreen #gameGrid {
                max-width: 95vw !important;
                max-height: 60vh !important;
            }
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .page-layout {
                grid-template-columns: 280px 1fr;
                gap: var(--spacing-xl);
            }
        }

        @media (max-width: 1200px) {
            .page-layout {
                grid-template-columns: 250px 1fr;
                gap: var(--spacing-lg);
            }
            
            .game-container {
                grid-template-columns: 1fr 300px;
            }
        }

        @media (max-width: 768px) {
            .page-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                gap: var(--spacing-lg);
            }
            
            .nav-sidebar {
                position: static;
                margin-bottom: var(--spacing-lg);
            }
            
            .game-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }
            
            .game-header h1 {
                font-size: 2rem;
            }
            
            .controls-section {
                grid-template-columns: 1fr;
            }
            
            .game-info {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Animation Enhancements */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .game-container {
            animation: fadeInUp 0.6s ease-out;
        }

        .sidebar-section {
            animation: fadeInUp 0.6s ease-out;
        }

        /* Minimal Compact 3D Game Layout */
        .page-layout {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: var(--spacing-md);
            height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
            padding: var(--spacing-sm);
            overflow: hidden;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            height: 100vh;
            overflow: hidden;
        }

        /* Minimal Game Header */
        .game-header {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.95));
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .game-header h1 {
            color: var(--primary-color);
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: var(--spacing-xs);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .game-header p {
            color: var(--gray-600);
            font-size: 0.9rem;
            line-height: 1.4;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        /* Minimal Game Container */
        .game-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.95));
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: grid;
            grid-template-columns: 1fr 250px;
            gap: var(--spacing-md);
            height: calc(100vh - 120px);
            position: relative;
            overflow: hidden;
            flex: 1;
        }

        /* Minimal Game Controls & Configuration */
        .game-controls-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .controls-section, .config-section {
            padding: var(--spacing-sm);
        }

        .controls-section h3, .config-section h3 {
            color: var(--primary-color);
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            border-bottom: 1px solid var(--primary-color);
            padding-bottom: var(--spacing-xs);
        }

        /* Minimal Control Buttons */
        .control-buttons {
            display: flex;
            gap: var(--spacing-xs);
            flex-wrap: wrap;
        }

        .control-buttons .btn {
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: 0.8rem;
            min-width: 70px;
            border-radius: var(--radius-sm);
        }

        /* Minimal Configuration Options */
        .config-options {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .config-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .config-group h4 {
            color: var(--gray-700);
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .config-buttons {
            display: flex;
            gap: var(--spacing-xs);
            flex-wrap: wrap;
        }

        .config-buttons .btn {
            padding: var(--spacing-xs);
            font-size: 0.75rem;
            min-width: 60px;
            border-radius: var(--radius-sm);
        }

        /* Minimal Game Canvas */
        .game-canvas-container {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: var(--radius-md);
            padding: var(--spacing-sm);
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #gameCanvas {
            max-width: 100%;
            max-height: 100%;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-md);
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: block;
        }

        /* Responsive Design for Minimal 3D Layout */
        @media (max-width: 1400px) {
            .page-layout {
                grid-template-columns: 180px 1fr;
                gap: var(--spacing-sm);
                padding: var(--spacing-xs);
            }
            
            .game-container {
                grid-template-columns: 1fr 220px;
                gap: var(--spacing-sm);
            }
            
            .game-header h1 {
                font-size: 1.3rem;
            }
            
            .game-header p {
                font-size: 0.8rem;
            }
            
            .controls-section h3, .config-section h3 {
                font-size: 0.8rem;
            }
            
            .control-buttons .btn {
                padding: var(--spacing-xs);
                font-size: 0.75rem;
                min-width: 65px;
            }
        }

        @media (max-width: 1200px) {
            .page-layout {
                grid-template-columns: 160px 1fr;
                gap: var(--spacing-xs);
            }
            
            .game-container {
                grid-template-columns: 1fr 200px;
                gap: var(--spacing-xs);
            }
            
            .game-controls-section {
                padding: var(--spacing-sm);
                gap: var(--spacing-sm);
            }
            
            .controls-section, .config-section {
                padding: var(--spacing-xs);
            }
            
            .config-buttons .btn {
                padding: var(--spacing-xs);
                font-size: 0.7rem;
                min-width: 55px;
            }
        }

        @media (max-width: 1024px) {
            .page-layout {
                grid-template-columns: 140px 1fr;
                gap: var(--spacing-xs);
                padding: var(--spacing-xs);
            }
            
            .game-container {
                grid-template-columns: 1fr 180px;
                gap: var(--spacing-xs);
                padding: var(--spacing-sm);
            }
            
            .game-header {
                padding: var(--spacing-sm);
            }
            
            .game-header h1 {
                font-size: 1.2rem;
            }
            
            .game-controls-section {
                padding: var(--spacing-sm);
                gap: var(--spacing-sm);
            }
            
            .control-buttons {
                gap: var(--spacing-xs);
            }
            
            .config-options {
                gap: var(--spacing-xs);
            }
        }

        /* Ensure no scrolling on any screen size */
        body {
            overflow: hidden;
        }

        .main-content {
            overflow: hidden;
        }

        .game-canvas-container {
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-layout">
            <!-- Navigation Menu -->
            <div class="nav-sidebar">
                <h3>Navigation</h3>
                <div class="nav-links">
                    <a href="index.html"><i class="fas fa-home"></i> Accueil</a>
                    <a href="prototype.html"><i class="fas fa-flask"></i> Maquette 2D</a>
                    <a href="game.html" class="active"><i class="fas fa-gamepad"></i> Maquette 3D</a>
                    <a href="GDD.html"><i class="fas fa-file-alt"></i> Documentation</a>
                    <a href="moodboard.html"><i class="fas fa-palette"></i> Moodboard</a>
                    <a href="sitemap.html"><i class="fas fa-sitemap"></i> Plan de Site</a>
                </div>
        </div>

            <div class="main-content">
                <div class="game-section">
                    <!-- Enhanced Game Header -->
                    <div class="game-header">
                        <h1>🎮 Maquette 3D - Letters Cascade Challenge</h1>
                        <p>Mode immersif avec grille 3D - Jouabilité avancée</p>
        </div>

                    <div class="game-container">
                        <div class="game-main">
                            <!-- Enhanced Controls Section -->
                            <div class="controls-section">
                                <div class="game-controls">
                                    <h3><i class="fas fa-gamepad"></i> CONTRÔLES DU JEU</h3>
                                    <div class="game-controls">
                                        <button class="btn" onclick="game3D.startGame()">
                                            <i class="fas fa-play"></i> Démarrer
                                        </button>
                                        <button class="btn" onclick="game3D.pauseGame()">
                                            <i class="fas fa-pause"></i> Pause
                                        </button>
                                        <button class="btn" onclick="game3D.resetGame()">
                                            <i class="fas fa-redo"></i> Reset
                                        </button>
                                        <button class="btn" onclick="game3D.toggleFullScreen()">
                                            <i class="fas fa-expand"></i> Plein Écran
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="configuration">
                                    <h3><i class="fas fa-cog"></i> CONFIGURATION</h3>
                                    <div class="config-group">
                                        <label>Mode de Jeu</label>
                                        <div class="config-buttons">
                                            <button class="config-btn" onclick="game3D.selectMode('2d')">Mode 2D</button>
                                            <button class="config-btn active" onclick="game3D.selectMode('3d')">Mode 3D</button>
                                        </div>
                                    </div>
                                    <div class="config-group">
                                        <label>Taille de Grille</label>
                                        <div class="config-buttons">
                                            <button class="config-btn" onclick="game3D.selectGrid(8)">8x8</button>
                                            <button class="config-btn active" onclick="game3D.selectGrid(10)">10x10</button>
                                            <button class="config-btn" onclick="game3D.selectGrid(12)">12x12</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced Game Grid Container -->
                            <div class="game-grid-container">
                                <div id="gameGrid">
                                    <!-- 3D Game Canvas will be rendered here -->
                                </div>
                            </div>

                            <!-- Enhanced Game Info -->
                            <div class="game-info">
                                <div class="info-section">
                                    <h4>Score</h4>
                                    <div class="value" id="score">0</div>
                                </div>
                                <div class="info-section">
                                    <h4>Niveau</h4>
                                    <div class="value" id="level">1</div>
                                </div>
                                <div class="info-section">
                                    <h4>Mots Complétés</h4>
                                    <div class="value" id="wordsCompleted">0</div>
                                </div>
                            </div>

                            <!-- Enhanced Score Display -->
                            <div class="score-display">
                                <span>Score Total: </span>
                                <strong id="totalScore">0</strong>
                            </div>
                        </div>

                        <!-- Enhanced Sidebar -->
                        <div class="sidebar">
                            <div class="sidebar-section">
                                <h3><i class="fas fa-list"></i> Mots à compléter</h3>
                                <ul class="word-list" id="wordList">
                                    <li>CHAT</li>
                                    <li>MAISON</li>
                                    <li>MUSIQUE</li>
                                    <li>JARDIN</li>
                                    <li>LIVRE</li>
                                    <li>TABLE</li>
                                    <li>PORTE</li>
                                    <li>FENETRE</li>
                                </ul>
                            </div>

                            <div class="sidebar-section">
                                <h3><i class="fas fa-eye"></i> PROCHAINES LETTRES</h3>
                                <div class="letter-queue">
                                    <div class="queue-display" id="letterQueue">
                                        <div class="queue-letter">A</div>
                                        <div class="queue-letter">B</div>
                                        <div class="queue-letter">C</div>
                                        <div class="queue-letter">D</div>
                                        <div class="queue-letter">E</div>
                                    </div>
                                </div>
                            </div>

                            <div class="sidebar-section">
                                <h3><i class="fas fa-trophy"></i> Progression</h3>
                                <p><strong>Niveau :</strong> <span id="currentLevel">1</span></p>
                                <p><strong>Score requis :</strong> <span id="requiredScore">100</span></p>
                                <p><strong>Mots trouvés :</strong> <span id="wordsFound">0</span>/8</p>
                            </div>
                        </div>
                    </div>

                    <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                        <div class="loading-spinner"></div>
                        Chargement du jeu...
        </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <script>
        // Complete 3D Game Engine for Letters Cascade Challenge
        // Implements all functionalities from technical specifications
        class Game3D {
            constructor() {
                console.log('🔧 Game3D constructor called');
                
                // Game Configuration
                this.mode = '3d';
                this.gridSizes = [8, 10, 12];
                this.currentGridSize = 10;
                this.cellSize = 1.2;
                this.gap = 0.2;
                
                // Game State
                this.gameRunning = false;
                this.paused = false;
                this.gameOver = false;
                this.level = 1;
                this.score = 0;
                this.highScore = this.loadHighScore();
                this.combo = 0;
                this.maxCombo = 0;
                this.startTime = null;
                
                // 3D Scene Components
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.raycaster = null;
                this.mouse = null;
                
                // Game Mechanics
                this.grid = [];
                this.letters = [];
                this.letterQueue = [];
                this.wordsFound = [];
                this.targetWords = [];
                this.fallingLetter = null;
                this.fallSpeed = 1000;
                this.fallTimer = null;
                
                // 3D Specific
                this.cubes = [];
                this.textMeshes = [];
                this.lights = [];
                this.particles = [];
                
                // Word Detection System
                this.dictionary = this.loadDictionary();
                this.wordDetector = new WordDetector3D(this.dictionary);
                
                // Scoring System
                this.scoreManager = new ScoreManager3D();
                
                // Level System
                this.levelManager = new LevelManager3D();
                
                // Audio System
                this.audioManager = new AudioManager3D();
                
                // Particle System
                this.particleSystem = new ParticleSystem3D();
                
                // Statistics
                this.stats = {
                    lettersPlaced: 0,
                    wordsCompleted: 0,
                    totalScore: 0,
                    playTime: 0,
                    startTime: null,
                    mode: '3D'
                };
                
                console.log('🔧 Game3D constructor completed, calling init()');
                this.init();
            }
            
            // Initialize 3D game
            init() {
                console.log('🚀 Initializing 3D game...');
                
                // Check WebGL support
                if (!this.checkWebGLSupport()) {
                    console.error('❌ WebGL not supported');
                    this.showWebGLError();
                    return;
                }
                
                // Initialize Three.js components
                this.initThreeJS();
                this.create3DGrid();
                this.setupEnhancedLighting();
                this.setupCamera();
                this.setupControls();
                this.generateLetterQueue();
                
                // Start animation loop
                this.animate();
                
                console.log('✅ 3D game initialized successfully');
            }
            
            // Enhanced Three.js Initialization
            initThreeJS() {
                console.log('🎨 Initializing Three.js components...');
                
                // Create scene with enhanced background
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x0a0a0a);
                
                // Add atmospheric fog
                this.scene.fog = new THREE.Fog(0x0a0a0a, 10, 50);
                
                // Create enhanced camera
                this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                this.camera.position.set(0, 15, 20);
                this.camera.lookAt(0, 0, 0);
                
                // Create enhanced renderer
                this.renderer = new THREE.WebGLRenderer({ 
                    antialias: true, 
                    alpha: true,
                    powerPreference: "high-performance"
                });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                this.renderer.toneMapping = THREE.ACESFilmicToneMapping;
                this.renderer.toneMappingExposure = 1.2;
                
                // Add renderer to DOM
                const container = document.getElementById('gameGrid');
                if (container) {
                    container.appendChild(this.renderer.domElement);
                }
                
                // Setup raycaster for mouse interaction
                this.raycaster = new THREE.Raycaster();
                this.mouse = new THREE.Vector2();
                
                console.log('✅ Three.js components initialized');
            }
            
            // Enhanced Lighting Setup
            setupEnhancedLighting() {
                console.log('💡 Setting up enhanced lighting...');
                
                // Ambient light for overall illumination
                const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
                this.scene.add(ambientLight);
                
                // Main directional light with shadows
                const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
                directionalLight.position.set(10, 20, 10);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                directionalLight.shadow.camera.near = 0.5;
                directionalLight.shadow.camera.far = 50;
                directionalLight.shadow.camera.left = -10;
                directionalLight.shadow.camera.right = 10;
                directionalLight.shadow.camera.top = 10;
                directionalLight.shadow.camera.bottom = -10;
                this.scene.add(directionalLight);
                
                // Point light for dramatic effect
                const pointLight = new THREE.PointLight(0x667eea, 0.8, 30);
                pointLight.position.set(0, 15, 0);
                this.scene.add(pointLight);
                
                // Spot light for focused illumination
                const spotLight = new THREE.SpotLight(0xffffff, 0.5, 30, Math.PI / 4, 0.5);
                spotLight.position.set(0, 20, 0);
                spotLight.target.position.set(0, 0, 0);
                this.scene.add(spotLight);
                this.scene.add(spotLight.target);
                
                console.log('✅ Enhanced lighting setup completed');
            }
            
            // WebGL Support Check
            checkWebGLSupport() {
                try {
                    const canvas = document.createElement('canvas');
                    return !!(window.WebGLRenderingContext && 
                        (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
                } catch (e) {
                    return false;
                }
            }
            
            showWebGLError() {
                const container = document.getElementById('gameGrid');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #ef4444;">
                            <h3>❌ WebGL Not Supported</h3>
                            <p>Your browser doesn't support WebGL. Please try a different browser or enable hardware acceleration.</p>
                            <button onclick="location.reload()" class="btn btn-primary">Reload Page</button>
                        </div>
                    `;
                }
            }
            
            // Setup Camera
            setupCamera() {
                this.camera.position.set(0, 0, 15);
                this.camera.lookAt(0, 0, 0);
            }
            
            // Setup Controls
            setupControls() {
                // Keyboard controls
                document.addEventListener('keydown', (event) => {
                    if (!this.gameRunning || this.paused) return;
                    
                    switch(event.key) {
                        case 'ArrowLeft':
                            this.moveFallingLetter(-1);
                            break;
                        case 'ArrowRight':
                            this.moveFallingLetter(1);
                            break;
                        case 'ArrowDown':
                            this.dropFallingLetter();
                            break;
                        case ' ':
                            this.rotateFallingLetter();
                            break;
                        case 'p':
                        case 'P':
                            this.togglePause();
                            break;
                        case 'r':
                        case 'R':
                            this.resetGame();
                            break;
                    }
                });
            }
            
            // Event Listeners
            setupEventListeners() {
                const canvas = this.renderer.domElement;
                
                // Mouse move for hover effects
                canvas.addEventListener('mousemove', (event) => {
                    this.onMouseMove(event);
                });
                
                // Mouse click for letter placement
                canvas.addEventListener('click', (event) => {
                    this.onCanvasClick(event);
                });
            }
            
            // Mouse Interaction
            onMouseMove(event) {
                const rect = this.renderer.domElement.getBoundingClientRect();
                this.mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                this.mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
                
                this.raycaster.setFromCamera(this.mouse, this.camera);
                const intersects = this.raycaster.intersectObjects(this.scene.children);
                
                // Reset all cube colors
                for (let row = 0; row < this.currentGridSize; row++) {
                    for (let col = 0; col < this.currentGridSize; col++) {
                        const cell = this.grid[row][col];
                        if (cell && !cell.userData.occupied) {
                            cell.material.color.setHex(0x2a2a3e);
                            cell.scale.set(1, 1, 1);
                        }
                    }
                }
                
                // Highlight hovered cube
                if (intersects.length > 0) {
                    const intersected = intersects[0].object;
                    if (intersected.userData && !intersected.userData.occupied) {
                        intersected.material.color.setHex(0x4ecdc4);
                        intersected.scale.set(1.1, 1.1, 1.1);
                    }
                }
            }
            
            // Canvas Click
            onCanvasClick(event) {
                if (!this.gameRunning || this.paused || !this.fallingLetter) return;
                
                const rect = this.renderer.domElement.getBoundingClientRect();
                this.mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                this.mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
                
                this.raycaster.setFromCamera(this.mouse, this.camera);
                const intersects = this.raycaster.intersectObjects(this.scene.children);
                
                if (intersects.length > 0) {
                    const intersected = intersects[0].object;
                    if (intersected.userData && !intersected.userData.occupied) {
                        this.placeLetter3D(intersected.userData.row, intersected.userData.col, event);
                    }
                }
            }
            
            // Place Letter in 3D
            placeLetter3D(row, col, event) {
                console.log('🎯 placeLetter3D() called - row:', row, 'col:', col, 'letters remaining:', this.letters.length);
                
                if (this.letterQueue.length === 0) {
                    this.generateLetterQueue();
                }
                
                const letter = this.letterQueue.shift();
                const cell = this.grid[row][col];
                
                if (!cell || cell.userData.occupied) {
                    console.warn('⚠️ Cell already occupied or invalid');
                    return;
                }
                
                // Create 3D text
                const canvas = document.createElement('canvas');
                canvas.width = 128;
                canvas.height = 128;
                const context = canvas.getContext('2d');
                
                // Create gradient background
                const gradient = context.createLinearGradient(0, 0, 128, 128);
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
                context.fillStyle = gradient;
                context.fillRect(0, 0, 128, 128);
                
                // Add text shadow
                context.shadowColor = 'rgba(0, 0, 0, 0.5)';
                context.shadowBlur = 4;
                context.shadowOffsetX = 2;
                context.shadowOffsetY = 2;
                
                // Draw letter
                context.fillStyle = 'white';
                context.font = 'bold 72px Arial';
                context.textAlign = 'center';
                context.textBaseline = 'middle';
                context.fillText(letter, 64, 64);
                
                // Create texture
                const texture = new THREE.CanvasTexture(canvas);
                const textGeometry = new THREE.PlaneGeometry(0.8, 0.8);
                const textMaterial = new THREE.MeshBasicMaterial({ 
                    map: texture,
                    transparent: true,
                    alphaTest: 0.5
                });
                
                const textMesh = new THREE.Mesh(textGeometry, textMaterial);
                textMesh.position.copy(cell.position);
                textMesh.position.y += 0.6;
                textMesh.rotation.x = -Math.PI / 2;
                
                // Add glow effect
                const glowGeometry = new THREE.PlaneGeometry(1, 1);
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: 0x4ecdc4,
                    transparent: true,
                    opacity: 0.3
                });
                
                const glowMesh = new THREE.Mesh(glowGeometry, glowMaterial);
                glowMesh.position.copy(textMesh.position);
                glowMesh.position.y += 0.01;
                glowMesh.rotation.x = -Math.PI / 2;
                
                // Add to scene
                this.scene.add(textMesh);
                this.scene.add(glowMesh);
                
                // Update cell data
                cell.userData.letter = textMesh;
                cell.userData.glow = glowMesh;
                cell.userData.occupied = true;
                cell.userData.letterValue = letter;
                
                // Change cube color
                cell.material.color.setHex(0x4ecdc4);
                
                // Add scale animation
                this.addPulseAnimation(textMesh);
                this.addPulseAnimation(glowMesh);
                
                // Update game state
                this.stats.lettersPlaced++;
                this.audioManager.playPlace();
                this.particleSystem.createPlacementEffect3D(cell.position);
                
                // Check for word completion
                this.checkWordCompletion();
                
                // Update display
                this.updateDisplay();
                
                console.log('✅ Letter placed successfully in 3D scene');
            }
            
            // Add Pulse Animation
            addPulseAnimation(mesh) {
                const scale = { value: 1 };
                const tween = new TWEEN.Tween(scale)
                    .to({ value: 1.2 }, 200)
                    .easing(TWEEN.Easing.Quadratic.Out)
                    .onUpdate(() => {
                        mesh.scale.set(scale.value, scale.value, scale.value);
                    })
                    .yoyo(true)
                    .repeat(1)
                    .start();
            }
            
            // Generate Letter Queue
            generateLetterQueue() {
                console.log('📝 Generating 3D letter queue...');
                this.letterQueue = [];
                const vowels = ['A', 'E', 'I', 'O', 'U'];
                const consonants = ['B', 'C', 'D', 'F', 'G', 'H', 'J', 'K', 'L', 'M', 'N', 'P', 'Q', 'R', 'S', 'T', 'V', 'W', 'X', 'Y', 'Z'];
                
                // Balanced letter distribution
                for (let i = 0; i < 10; i++) {
                    if (Math.random() < 0.4) {
                        this.letterQueue.push(vowels[Math.floor(Math.random() * vowels.length)]);
                    } else {
                        this.letterQueue.push(consonants[Math.floor(Math.random() * consonants.length)]);
                    }
                }
                
                console.log('✅ 3D letter queue generated:', this.letterQueue);
                this.updateLetterQueueDisplay();
            }
            
            // Word Detection for 3D
            checkWordCompletion() {
                if (this.mode === '3d') {
                    console.log('🎮 Checking 3D word completion');
                    this.checkWordCompletion3D();
                }
            }
            
            checkWordCompletion3D() {
                console.log('🎮 checkWordCompletion3D() called');
                
                // Create 2D grid from 3D grid data
                const grid = [];
                for (let row = 0; row < this.currentGridSize; row++) {
                    grid[row] = [];
                    for (let col = 0; col < this.currentGridSize; col++) {
                        // Extract letter from 3D mesh (simplified)
                        grid[row][col] = this.getLetterFrom3DMesh(this.grid[row][col].userData.letter) || '';
                    }
                }
                
                console.log('📐 3D grid created:', grid);
                
                // Use word detector
                const words = this.wordDetector.scanGrid(grid);
                console.log('📝 Words found in 3D:', words);
                
                if (words.length > 0) {
                    words.forEach(word => {
                        this.completeWord3D(word);
                    });
                    
                    // Update combo
                    this.combo += words.length;
                    if (this.combo > this.maxCombo) {
                        this.maxCombo = this.combo;
                    }
                    
                    // Add combo bonus
                    if (this.combo > 1) {
                        const comboBonus = this.combo * 50;
                        this.addScore(comboBonus);
                        this.showComboEffect3D(comboBonus);
                    }
                } else {
                    this.combo = 0;
                }
                
                this.updateDisplay();
            }
            
            getLetterFrom3DMesh(mesh) {
                console.log('🔍 getLetterFrom3DMesh() called for mesh:', mesh);
                if (!mesh || !mesh.userData) return null;
                return mesh.userData.letterValue;
            }
            
            completeWord3D(word) {
                console.log('🏆 Word completed in 3D:', word);
                
                // Add word to found list
                this.wordsFound.push(word);
                
                // Calculate score
                const wordScore = word.length * 10;
                this.addScore(wordScore);
                
                // Remove word from 3D grid
                this.removeWordFrom3DGrid(word);
                
                // Create 3D particle effect
                this.particleSystem.createWordCompletionEffect3D(word);
                
                // Play sound
                this.audioManager.playWordComplete();
                
                // Check level progression
                this.levelManager.checkLevelProgression(this.wordsFound.length);
                
                console.log('✅ 3D word completed:', word, 'Score:', wordScore);
            }
            
            removeWordFrom3DGrid(word) {
                // Find and remove letters of the word from 3D grid
                for (let row = 0; row < this.currentGridSize; row++) {
                    for (let col = 0; col < this.currentGridSize; col++) {
                        const cell = this.grid[row][col];
                        if (cell.userData.letterValue === word[0]) {
                            // Check if this is the start of the word
                            if (this.checkWordAt3DPosition(row, col, word)) {
                                this.removeWordAt3DPosition(row, col, word);
                                return;
                            }
                        }
                    }
                }
            }
            
            checkWordAt3DPosition(row, col, word) {
                // Check horizontal
                if (col + word.length <= this.currentGridSize) {
                    let match = true;
                    for (let i = 0; i < word.length; i++) {
                        if (this.grid[row][col + i].userData.letterValue !== word[i]) {
                            match = false;
                            break;
                        }
                    }
                    if (match) return true;
                }
                
                // Check vertical
                if (row + word.length <= this.currentGridSize) {
                    let match = true;
                    for (let i = 0; i < word.length; i++) {
                        if (this.grid[row + i][col].userData.letterValue !== word[i]) {
                            match = false;
                            break;
                        }
                    }
                    if (match) return true;
                }
                
                return false;
            }
            
            removeWordAt3DPosition(row, col, word) {
                // Remove letters from 3D grid
                for (let i = 0; i < word.length; i++) {
                    const cell = this.grid[row][col + i];
                    if (cell.userData.letter) {
                        this.scene.remove(cell.userData.letter);
                    }
                    if (cell.userData.glow) {
                        this.scene.remove(cell.userData.glow);
                    }
                    cell.userData.letter = null;
                    cell.userData.glow = null;
                    cell.userData.occupied = false;
                    cell.userData.letterValue = null;
                    cell.material.color.setHex(0x2a2a3e);
                }
            }
            
            // Scoring System
            addScore(points) {
                console.log('💰 Adding 3D score:', points);
                this.score += points;
                this.stats.totalScore += points;
                
                // Update high score
                if (this.score > this.highScore) {
                    this.highScore = this.score;
                    this.saveHighScore();
                }
                
                this.scoreManager.updateScore(this.score);
                this.updateDisplay();
            }
            
            // Game Controls
            startGame() {
                console.log('▶️ Starting 3D game...');
                
                if (this.gameRunning) return;
                
                this.gameRunning = true;
                this.paused = false;
                this.gameOver = false;
                this.stats.startTime = Date.now();
                this.startTime = Date.now();
                
                this.audioManager.playStart();
                console.log('✅ 3D game started');
            }
            
            pauseGame() {
                console.log('⏸️ Pausing 3D game...');
                
                if (!this.gameRunning) return;
                
                this.paused = !this.paused;
                
                if (this.paused) {
                    this.audioManager.playPause();
                } else {
                    this.audioManager.playResume();
                }
                
                this.updateDisplay();
                console.log('✅ 3D game paused:', this.paused);
            }
            
            resetGame() {
                console.log('🔄 Resetting 3D game...');
                
                this.gameRunning = false;
                this.paused = false;
                this.gameOver = false;
                this.score = 0;
                this.level = 1;
                this.combo = 0;
                this.maxCombo = 0;
                this.wordsFound = [];
                this.fallSpeed = 1000;
                
                this.clear3DGrid();
                this.generateLetterQueue();
                this.updateDisplay();
                
                this.audioManager.playReset();
                console.log('✅ 3D game reset');
            }
            
            clear3DGrid() {
                console.log('🎮 Clearing 3D grid');
                
                for (let row = 0; row < this.currentGridSize; row++) {
                    for (let col = 0; col < this.currentGridSize; col++) {
                        const cell = this.grid[row][col];
                        if (cell.userData.letter) {
                            this.scene.remove(cell.userData.letter);
                        }
                        if (cell.userData.glow) {
                            this.scene.remove(cell.userData.glow);
                        }
                        cell.userData.letter = null;
                        cell.userData.glow = null;
                        cell.userData.occupied = false;
                        cell.userData.letterValue = null;
                        cell.material.color.setHex(0x2a2a3e);
                        cell.material.opacity = 1;
                    }
                }
            }
            
            // Display Updates
            updateDisplay() {
                console.log('📊 updateDisplay() called - score:', this.score, 'level:', this.level, 'mode:', this.mode);
                
                const scoreElement = document.getElementById('score');
                const levelElement = document.getElementById('level');
                const timeElement = document.getElementById('timeValue');
                const wordsElement = document.getElementById('wordsCompleted');
                const modeElement = document.getElementById('currentMode');
                const gridElement = document.getElementById('currentGrid');
                
                console.log('📦 Display elements found:', {
                    score: scoreElement,
                    level: levelElement,
                    time: timeElement,
                    words: wordsElement,
                    mode: modeElement,
                    grid: gridElement
                });
                
                if (scoreElement) scoreElement.textContent = this.score;
                if (levelElement) levelElement.textContent = this.level;
                
                // Update mode display
                if (modeElement) {
                    const modeText = this.mode === '3d' ? '3D' : '2D';
                    modeElement.textContent = modeText;
                    console.log('🎮 Mode display updated to:', modeText);
                }
                
                // Update grid size display
                if (gridElement) {
                    gridElement.textContent = `${this.currentGridSize}×${this.currentGridSize}`;
                    console.log('📐 Grid display updated to:', `${this.currentGridSize}×${this.currentGridSize}`);
                }
                
                // Update time if game is running
                if (this.gameRunning && this.startTime) {
                    const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
                    if (timeElement) timeElement.textContent = `${Math.floor(elapsed / 60)}:${(elapsed % 60).toString().padStart(2, '0')}`;
                }
                
                if (wordsElement) wordsElement.textContent = this.wordsFound.length;
                
                // Update mode buttons to reflect current mode
                this.updateModeButtons();
                
                console.log('✅ Display updated');
            }
            
            updateModeButtons() {
                console.log('🎮 updateModeButtons() called - current mode:', this.mode);
                
                const modeButtons = document.querySelectorAll('.mode-btn');
                modeButtons.forEach(btn => {
                    const btnMode = btn.dataset.mode;
                    if (btnMode === this.mode) {
                        btn.classList.add('active');
                        console.log('✅ Mode button activated:', btnMode);
                    } else {
                        btn.classList.remove('active');
                        console.log('❌ Mode button deactivated:', btnMode);
                    }
                });
            }
            
            // Enhanced Animation Loop
            animate() {
                requestAnimationFrame(() => this.animate());
                
                if (!this.gameRunning || this.paused) {
                    this.renderer.render(this.scene, this.camera);
                    return;
                }
                
                // Enhanced camera movement
                this.updateCamera();
                
                // Update falling letter
                this.updateFallingLetter();
                
                // Update particles
                this.particleSystem.update();
                
                // Update letter animations
                this.updateLetterAnimations();
                
                // Render scene
                this.renderer.render(this.scene, this.camera);
            }
            
            // Enhanced Camera Movement
            updateCamera() {
                const time = Date.now() * 0.001;
                
                // Gentle camera movement
                this.camera.position.x = Math.sin(time * 0.5) * 2;
                this.camera.position.y = 15 + Math.sin(time * 0.3) * 1;
                this.camera.position.z = 20 + Math.cos(time * 0.5) * 2;
                
                // Look at the center of the grid
                this.camera.lookAt(0, 0, 0);
            }
            
            // Enhanced Letter Animations
            updateLetterAnimations() {
                this.textMeshes.forEach(mesh => {
                    if (mesh.userData.isFalling) {
                        // Pulsing animation for falling letters
                        const time = Date.now() * 0.005;
                        const pulse = Math.sin(time) * 0.1 + 1;
                        mesh.scale.setScalar(pulse);
                        
                        // Update glow effect
                        if (mesh.userData.glowMesh) {
                            mesh.userData.glowMesh.scale.setScalar(pulse * 1.1);
                            mesh.userData.glowMesh.material.opacity = 0.3 * pulse;
                        }
                    } else {
                        // Gentle floating animation for placed letters
                        const time = Date.now() * 0.002;
                        mesh.position.y = mesh.userData.originalY + Math.sin(time + mesh.userData.offset) * 0.05;
                    }
                });
            }
            
            // Enhanced Falling Letter Update
            updateFallingLetter() {
                if (!this.fallingLetter) return;
                
                const time = Date.now() * 0.001;
                
                // Update falling letter position
                this.fallingLetter.y += 0.02;
                
                // Check collision
                if (this.checkCollision3D(this.fallingLetter.x, this.fallingLetter.y, this.fallingLetter.z)) {
                    this.placeLetter3D();
                }
                
                // Update visual representation
                this.updateFallingLetterVisual();
            }
            
            // Enhanced Letter Placement
            placeLetter3D() {
                if (!this.fallingLetter) return;
                
                const { x, y, z, letter } = this.fallingLetter;
                
                console.log('📝 Placing 3D letter:', letter, 'at position:', { x, y, z });
                
                // Place letter in grid
                const gridX = Math.floor((x + this.currentGridSize * (this.cellSize + this.gap) / 2) / (this.cellSize + this.gap));
                const gridZ = Math.floor((z + this.currentGridSize * (this.cellSize + this.gap) / 2) / (this.cellSize + this.gap));
                
                if (gridX >= 0 && gridX < this.currentGridSize && gridZ >= 0 && gridZ < this.currentGridSize) {
                    this.grid[gridZ][gridX] = letter;
                    
                    // Create visual letter
                    this.createLetter3D(letter, x, y, z, false);
                    
                    // Create placement effect
                    this.particleSystem.createPlacementEffect3D(x, y, z);
                    
                    // Play sound
                    this.audioManager.playPlace();
                    
                    // Check for word completion
                    this.checkWordCompletion3D();
                    
                    // Create new falling letter
                    this.createFallingLetter3D();
                }
            }
            
            // Utility Methods
            updateLetterQueueDisplay() {
                const queueElement = document.getElementById('letterQueue');
                if (queueElement) {
                    queueElement.innerHTML = '';
                    this.letterQueue.slice(0, 5).forEach(letter => {
                        const span = document.createElement('span');
                        span.textContent = letter;
                        span.className = 'queue-letter';
                        queueElement.appendChild(span);
                    });
                }
            }
            
            showComboEffect3D(bonus) {
                this.particleSystem.createComboEffect3D(bonus);
            }
            
            // Storage
            saveHighScore() {
                localStorage.setItem('lettersCascade3DHighScore', this.highScore.toString());
            }
            
            loadHighScore() {
                const saved = localStorage.getItem('lettersCascade3DHighScore');
                return saved ? parseInt(saved) : 0;
            }
            
            loadDictionary() {
                // French dictionary for word validation
                return new Set([
                    'BONJOUR', 'AU REVOIR', 'MERCI', 'SIL VOUS PLAIT', 'PARDON',
                    'OUI', 'NON', 'PEUT ETRE', 'CERTAINEMENT', 'PROBABLEMENT',
                    'MAINTENANT', 'AUJOURDHUI', 'HIER', 'DEMAIN', 'TOUJOURS',
                    'JAMAIS', 'PARFOIS', 'SOUVENT', 'RAREMENT', 'QUELQUEFOIS',
                    'BON', 'MAUVAIS', 'GRAND', 'PETIT', 'NOUVEAU', 'VIEUX',
                    'BEAU', 'JOLI', 'MOCHE', 'FORT', 'FAIBLE', 'RAPIDE', 'LENT',
                    'CHALEUREUX', 'FROID', 'CHAUD', 'DOUX', 'DUR', 'MOLLE',
                    'CLAIR', 'SOMBRE', 'LUMINEUX', 'OBSCUR', 'TRANSPARENT',
                    'OPAQUE', 'COLORE', 'BLANC', 'NOIR', 'ROUGE', 'BLEU',
                    'VERT', 'JAUNE', 'ORANGE', 'VIOLET', 'ROSE', 'GRIS',
                    'MARRON', 'BEIGE', 'DORE', 'ARGENTE', 'BRONZE', 'CUIVRE'
                ]);
            }
            
            // Mode and Grid Selection Methods
            selectMode(mode) {
                console.log('🎮 selectMode called with mode:', mode);
                this.mode = mode;
                this.updateDisplay();
                this.updateModeButtons();
            }
            
            selectGrid(size) {
                console.log('🎮 selectGrid called with size:', size);
                if (this.gridSizes.includes(size)) {
                    this.currentGridSize = size;
                    this.create3DGrid();
                    this.generateLetterQueue();
                    this.updateDisplay();
                }
            }

            // Enhanced 3D Grid Creation
            create3DGrid() {
                console.log('🏗️ Creating enhanced 3D grid...');
                
                this.grid = [];
                this.cubes = [];
                
                const gridSize = this.currentGridSize;
                const cellSize = this.cellSize;
                const gap = this.gap;
                const totalSize = gridSize * (cellSize + gap) - gap;
                const startX = -totalSize / 2;
                const startZ = -totalSize / 2;
                
                // Create grid array
                for (let row = 0; row < gridSize; row++) {
                    this.grid[row] = [];
                    for (let col = 0; col < gridSize; col++) {
                        this.grid[row][col] = null;
                    }
                }
                
                // Create visual grid cells
                for (let row = 0; row < gridSize; row++) {
                    for (let col = 0; col < gridSize; col++) {
                        const x = startX + col * (cellSize + gap) + cellSize / 2;
                        const z = startZ + row * (cellSize + gap) + cellSize / 2;
                        const y = 0;
                        
                        // Create enhanced cube geometry
                        const geometry = new THREE.BoxGeometry(cellSize, 0.1, cellSize);
                        
                        // Create enhanced material with glass effect
                        const material = new THREE.MeshPhongMaterial({
                            color: 0xffffff,
                            transparent: true,
                            opacity: 0.3,
                            shininess: 100,
                            specular: 0x444444
                        });
                        
                        const cube = new THREE.Mesh(geometry, material);
                        cube.position.set(x, y, z);
                        cube.castShadow = true;
                        cube.receiveShadow = true;
                        cube.userData = { row, col, type: 'grid' };
                        
                        this.scene.add(cube);
                        this.cubes.push(cube);
                    }
                }
                
                console.log('✅ Enhanced 3D grid created with', this.cubes.length, 'cells');
            }
            
            // Enhanced Letter Creation
            createLetter3D(letter, x, y, z, isFalling = false) {
                console.log('📝 Creating 3D letter:', letter, 'at position:', { x, y, z });
                
                // Create enhanced text geometry
                const loader = new THREE.FontLoader();
                const fontUrl = 'https://threejs.org/examples/fonts/helvetiker_regular.typeface.json';
                
                loader.load(fontUrl, (font) => {
                    const textGeometry = new THREE.TextGeometry(letter, {
                        font: font,
                        size: 0.8,
                        height: 0.2,
                        curveSegments: 12,
                        bevelEnabled: true,
                        bevelThickness: 0.03,
                        bevelSize: 0.02,
                        bevelOffset: 0,
                        bevelSegments: 5
                    });
                    
                    // Center the geometry
                    textGeometry.computeBoundingBox();
                    const centerOffset = -0.5 * (textGeometry.boundingBox.max.x - textGeometry.boundingBox.min.x);
                    
                    // Create enhanced material
                    const material = new THREE.MeshPhongMaterial({
                        color: isFalling ? 0x667eea : 0x4f46e5,
                        transparent: true,
                        opacity: 0.9,
                        shininess: 80,
                        specular: 0x222222
                    });
                    
                    const textMesh = new THREE.Mesh(textGeometry, material);
                    textMesh.position.set(x + centerOffset, y, z);
                    textMesh.castShadow = true;
                    textMesh.receiveShadow = true;
                    textMesh.userData = { letter, isFalling, type: 'letter' };
                    
                    // Add glow effect for falling letters
                    if (isFalling) {
                        const glowGeometry = textGeometry.clone();
                        const glowMaterial = new THREE.MeshBasicMaterial({
                            color: 0x667eea,
                            transparent: true,
                            opacity: 0.3
                        });
                        const glowMesh = new THREE.Mesh(glowGeometry, glowMaterial);
                        glowMesh.position.set(x + centerOffset, y, z);
                        glowMesh.scale.setScalar(1.1);
                        this.scene.add(glowMesh);
                        textMesh.userData.glowMesh = glowMesh;
                    }
                    
                    this.scene.add(textMesh);
                    this.textMeshes.push(textMesh);
                    
                    console.log('✅ 3D letter created:', letter);
                });
            }

            // Fullscreen functionality
            toggleFullScreen() {
                console.log('🖥️ Game3D.toggleFullScreen() called');
                
                const gameContainer = document.querySelector('.game-container');
                const fullscreenBtn = document.querySelector('button[onclick="game3D.toggleFullScreen()"]');
                
                console.log('📦 Game container found:', gameContainer);
                console.log('🔘 Fullscreen button found:', fullscreenBtn);
                
                if (gameContainer.classList.contains('fullscreen')) {
                    console.log('📤 Exiting fullscreen mode');
                    this.exitFullScreen();
                } else {
                    console.log('📥 Entering fullscreen mode');
                    this.enterFullScreen();
                }
            }
            
            enterFullScreen() {
                console.log('📥 Game3D.enterFullScreen() called');
                
                const gameContainer = document.querySelector('.game-container');
                const fullscreenBtn = document.querySelector('button[onclick="game3D.toggleFullScreen()"]');
                
                gameContainer.classList.add('fullscreen');
                if (fullscreenBtn) {
                    fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> Sortir';
                }
                
                // Add exit button
                const exitBtn = document.createElement('div');
                exitBtn.className = 'fullscreen-exit';
                exitBtn.innerHTML = '<i class="fas fa-times"></i>';
                exitBtn.onclick = () => this.exitFullScreen();
                gameContainer.appendChild(exitBtn);
                
                // Resize 3D renderer for full screen
                if (this.renderer) {
                    const container = gameContainer.querySelector('.game-grid-container');
                    const containerRect = container.getBoundingClientRect();
                    const maxWidth = Math.min(containerRect.width * 0.9, window.innerWidth * 0.8);
                    const maxHeight = Math.min(containerRect.height * 0.9, window.innerHeight * 0.7);
                    const canvasSize = Math.min(maxWidth, maxHeight);
                    
                    console.log('📐 Fullscreen dimensions:', {
                        containerWidth: containerRect.width,
                        containerHeight: containerRect.height,
                        maxWidth: maxWidth,
                        maxHeight: maxHeight,
                        canvasSize: canvasSize
                    });
                    
                    this.renderer.setSize(canvasSize, canvasSize);
                    
                    // Update camera aspect ratio
                    if (this.camera) {
                        this.camera.aspect = canvasSize / canvasSize;
                        this.camera.updateProjectionMatrix();
                        console.log('📷 Camera aspect ratio updated for fullscreen');
                    }
                    
                    // Enhance 3D scene for full screen
                    if (this.scene) {
                        // Adjust camera position for better view
                        this.camera.position.set(0, 0, 18);
                        this.camera.lookAt(0, 0, 0);
                        
                        // Enhance lighting for full screen
                        this.scene.children.forEach(child => {
                            if (child.type === 'DirectionalLight') {
                                child.intensity = 1.5;
                            } else if (child.type === 'PointLight') {
                                child.intensity = 1.2;
                            }
                        });
                        
                        console.log('🎬 3D scene enhanced for fullscreen');
                    }
                } else {
                    console.warn('⚠️ Renderer not available for fullscreen resize');
                }
                
                // Add keyboard shortcuts for full screen
                document.addEventListener('keydown', this.handleFullScreenKeyboard.bind(this));
                
                console.log('✅ Entered full screen mode');
            }
            
            exitFullScreen() {
                console.log('📤 Game3D.exitFullScreen() called');
                
                const gameContainer = document.querySelector('.game-container');
                const fullscreenBtn = document.querySelector('button[onclick="game3D.toggleFullScreen()"]');
                
                gameContainer.classList.remove('fullscreen');
                if (fullscreenBtn) {
                    fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> Plein Écran';
                }
                
                // Remove exit button
                const exitBtn = gameContainer.querySelector('.fullscreen-exit');
                if (exitBtn) {
                    gameContainer.removeChild(exitBtn);
                }
                
                // Reset 3D renderer size
                if (this.renderer) {
                    const container = gameContainer.querySelector('.game-grid-container');
                    const containerRect = container.getBoundingClientRect();
                    const size = Math.min(containerRect.width, containerRect.height);
                    
                    this.renderer.setSize(size, size);
                    
                    // Reset camera aspect ratio
                    if (this.camera) {
                        this.camera.aspect = size / size;
                        this.camera.updateProjectionMatrix();
                        console.log('📷 Camera aspect ratio reset');
                    }
                    
                    // Reset lighting
                    if (this.scene) {
                        this.scene.children.forEach(child => {
                            if (child.type === 'DirectionalLight') {
                                child.intensity = 1.0;
                            } else if (child.type === 'PointLight') {
                                child.intensity = 0.8;
                            }
                        });
                        
                        console.log('🎬 3D scene lighting reset');
                    }
                }
                
                // Remove keyboard shortcuts
                document.removeEventListener('keydown', this.handleFullScreenKeyboard.bind(this));
                
                console.log('✅ Exited full screen mode');
            }
            
            handleFullScreenKeyboard(event) {
                if (event.key === 'Escape') {
                    this.exitFullScreen();
                }
            }
        }
        
        // 3D Word Detection System
        class WordDetector3D {
            constructor(dictionary) {
                this.dictionary = dictionary;
            }
            
            scanGrid(grid) {
                const words = [];
                
                // Scan horizontal
                for (let row = 0; row < grid.length; row++) {
                    const rowWords = this.findWordsInRow(grid[row]);
                    words.push(...rowWords);
                }
                
                // Scan vertical
                for (let col = 0; col < grid[0].length; col++) {
                    const colLetters = grid.map(row => row[col]);
                    const colWords = this.findWordsInRow(colLetters);
                    words.push(...colWords);
                }
                
                return words;
            }
            
            findWordsInRow(letters) {
                const words = [];
                const rowString = letters.map(letter => letter || ' ').join('');
                
                // Find all possible words of 3+ letters
                for (let start = 0; start < rowString.length; start++) {
                    for (let length = 3; length <= rowString.length - start; length++) {
                        const word = rowString.substr(start, length).replace(/\s/g, '');
                        if (word.length >= 3 && this.validateWord(word)) {
                            words.push(word);
                        }
                    }
                }
                
                return words;
            }
            
            validateWord(word) {
                return this.dictionary.has(word.toUpperCase());
            }
        }
        
        // 3D Scoring System
        class ScoreManager3D {
            constructor() {
                this.currentScore = 0;
                this.highScore = 0;
            }
            
            updateScore(score) {
                this.currentScore = score;
                if (score > this.highScore) {
                    this.highScore = score;
                }
            }
            
            getScore() {
                return this.currentScore;
            }
            
            getHighScore() {
                return this.highScore;
            }
        }
        
        // 3D Level System
        class LevelManager3D {
            constructor() {
                this.levels = [
                    { minWords: 0, maxWords: 5, speed: 1000 },
                    { minWords: 5, maxWords: 10, speed: 900 },
                    { minWords: 10, maxWords: 15, speed: 800 },
                    { minWords: 15, maxWords: 20, speed: 700 },
                    { minWords: 20, maxWords: 25, speed: 600 },
                    { minWords: 25, maxWords: 30, speed: 500 },
                    { minWords: 30, maxWords: 35, speed: 400 },
                    { minWords: 35, maxWords: 40, speed: 300 },
                    { minWords: 40, maxWords: 45, speed: 200 },
                    { minWords: 45, maxWords: 50, speed: 150 }
                ];
            }
            
            getCurrentLevel(wordsFound) {
                for (let i = this.levels.length - 1; i >= 0; i--) {
                    if (wordsFound >= this.levels[i].minWords) {
                        return i + 1;
                    }
                }
                return 1;
            }
            
            checkLevelProgression(wordsFound) {
                const newLevel = this.getCurrentLevel(wordsFound);
                return newLevel;
            }
        }
        
        // 3D Audio System
        class AudioManager3D {
            constructor() {
                this.sounds = {};
                this.muted = false;
            }
            
            playStart() {
                this.playSound('start');
            }
            
            playPause() {
                this.playSound('pause');
            }
            
            playResume() {
                this.playSound('resume');
            }
            
            playReset() {
                this.playSound('reset');
            }
            
            playMove() {
                this.playSound('move');
            }
            
            playRotate() {
                this.playSound('rotate');
            }
            
            playPlace() {
                this.playSound('place');
            }
            
            playWordComplete() {
                this.playSound('wordComplete');
            }
            
            playLevelUp() {
                this.playSound('levelUp');
            }
            
            playSound(type) {
                if (this.muted) return;
                
                // Create audio context if not exists
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                // Generate simple tones for different sounds
                const frequency = this.getFrequencyForSound(type);
                const duration = 0.1;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            
            getFrequencyForSound(type) {
                const frequencies = {
                    start: 440,
                    pause: 330,
                    resume: 440,
                    reset: 220,
                    move: 660,
                    rotate: 550,
                    place: 880,
                    wordComplete: 1100,
                    levelUp: 1320
                };
                return frequencies[type] || 440;
            }
        }
        
        // Enhanced 3D Particle System
        class ParticleSystem3D {
            constructor() {
                this.particles = [];
                this.scene = null;
            }
            
            setScene(scene) {
                this.scene = scene;
            }
            
            createPlacementEffect3D(x, y, z) {
                console.log('✨ Creating 3D placement effect at:', { x, y, z });
                
                for (let i = 0; i < 20; i++) {
                    const geometry = new THREE.SphereGeometry(0.05, 8, 8);
                    const material = new THREE.MeshBasicMaterial({
                        color: 0x667eea,
                        transparent: true,
                        opacity: 0.8
                    });
                    
                    const particle = new THREE.Mesh(geometry, material);
                    particle.position.set(x, y, z);
                    
                    // Random velocity
                    particle.userData.velocity = new THREE.Vector3(
                        (Math.random() - 0.5) * 0.2,
                        Math.random() * 0.3,
                        (Math.random() - 0.5) * 0.2
                    );
                    
                    particle.userData.life = 1.0;
                    particle.userData.maxLife = 1.0;
                    
                    this.scene.add(particle);
                    this.particles.push(particle);
                }
            }
            
            createWordCompletionEffect3D(word, x, y, z) {
                console.log('🎉 Creating 3D word completion effect for:', word);
                
                // Create letter particles for each letter in the word
                for (let i = 0; i < word.length; i++) {
                    for (let j = 0; j < 10; j++) {
                        const geometry = new THREE.SphereGeometry(0.03, 6, 6);
                        const material = new THREE.MeshBasicMaterial({
                            color: 0x10b981,
                            transparent: true,
                            opacity: 0.9
                        });
                        
                        const particle = new THREE.Mesh(geometry, material);
                        particle.position.set(x + i * 0.5, y, z);
                        
                        // Explosive velocity
                        particle.userData.velocity = new THREE.Vector3(
                            (Math.random() - 0.5) * 0.5,
                            Math.random() * 0.8,
                            (Math.random() - 0.5) * 0.5
                        );
                        
                        particle.userData.life = 1.5;
                        particle.userData.maxLife = 1.5;
                        particle.userData.letter = word[i];
                        
                        this.scene.add(particle);
                        this.particles.push(particle);
                    }
                }
                
                // Create celebration particles
                for (let i = 0; i < 30; i++) {
                    const geometry = new THREE.SphereGeometry(0.02, 4, 4);
                    const material = new THREE.MeshBasicMaterial({
                        color: 0xffd700,
                        transparent: true,
                        opacity: 1.0
                    });
                    
                    const particle = new THREE.Mesh(geometry, material);
                    particle.position.set(x, y, z);
                    
                    // Spherical explosion
                    const angle = Math.random() * Math.PI * 2;
                    const phi = Math.random() * Math.PI;
                    const radius = 0.5 + Math.random() * 0.5;
                    
                    particle.userData.velocity = new THREE.Vector3(
                        Math.sin(phi) * Math.cos(angle) * radius,
                        Math.cos(phi) * radius,
                        Math.sin(phi) * Math.sin(angle) * radius
                    );
                    
                    particle.userData.life = 2.0;
                    particle.userData.maxLife = 2.0;
                    
                    this.scene.add(particle);
                    this.particles.push(particle);
                }
            }
            
            createLevelUpEffect3D() {
                console.log('🏆 Creating 3D level up effect');
                
                // Create spiral effect
                for (let i = 0; i < 50; i++) {
                    const geometry = new THREE.SphereGeometry(0.04, 6, 6);
                    const material = new THREE.MeshBasicMaterial({
                        color: 0x8b5cf6,
                        transparent: true,
                        opacity: 0.8
                    });
                    
                    const particle = new THREE.Mesh(geometry, material);
                    particle.position.set(0, 0, 0);
                    
                    // Spiral trajectory
                    const angle = (i / 50) * Math.PI * 4;
                    const radius = 2 + (i / 50) * 3;
                    const height = (i / 50) * 5;
                    
                    particle.userData.velocity = new THREE.Vector3(
                        Math.cos(angle) * radius * 0.1,
                        height * 0.1,
                        Math.sin(angle) * radius * 0.1
                    );
                    
                    particle.userData.life = 3.0;
                    particle.userData.maxLife = 3.0;
                    
                    this.scene.add(particle);
                    this.particles.push(particle);
                }
            }
            
            update() {
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const particle = this.particles[i];
                    
                    // Update position
                    particle.position.add(particle.userData.velocity);
                    
                    // Update life
                    particle.userData.life -= 0.016; // 60 FPS
                    
                    // Update opacity
                    particle.material.opacity = particle.userData.life / particle.userData.maxLife;
                    
                    // Update scale
                    particle.scale.setScalar(1 + (1 - particle.userData.life / particle.userData.maxLife) * 0.5);
                    
                    // Remove dead particles
                    if (particle.userData.life <= 0) {
                        this.scene.remove(particle);
                        this.particles.splice(i, 1);
                    }
                }
            }
        }

        // Global game instance
        let game3D;

        // Global functions for button controls
        function selectMode(mode) {
            if (game3D) game3D.selectMode(mode);
        }

        function selectGrid(size) {
            if (game3D) game3D.selectGrid(size);
        }

        function startGame() {
            if (game3D) game3D.startGame();
        }

        function resetGame() {
            if (game3D) game3D.resetGame();
        }

        function pauseGame() {
            if (game3D) game3D.pauseGame();
        }

        function clearGrid() {
            if (game3D) game3D.clearGrid();
        }

        // Initialize 3D game when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 DOM Content Loaded - Initializing 3D game...');
            
            // Check if Three.js is available
            if (typeof THREE === 'undefined') {
                console.error('❌ THREE.js not loaded!');
                // Show error message to user
                const container = document.getElementById('gameGrid');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #ff6b6b;">
                            <h3>❌ Erreur de chargement</h3>
                            <p>Three.js n'a pas pu être chargé. Veuillez rafraîchir la page.</p>
                        </div>
                    `;
                }
                return;
            }
            
            console.log('✅ THREE.js available, creating Game3D instance...');
            
            try {
                game3D = new Game3D();
                console.log('🎮 3D Game initialized successfully');
                
                // Check if Utils is available
                if (typeof Utils !== 'undefined') {
                    console.log('✅ Utils available for sound and particle effects');
                } else {
                    console.warn('⚠️ Utils not available - sound and particle effects disabled');
                }
                
                // Update display after initialization
                setTimeout(() => {
                    if (game3D && typeof game3D.updateDisplay === 'function') {
                        game3D.updateDisplay();
                        console.log('📊 Display updated after initialization');
                    }
                }, 100);
                
            } catch (error) {
                console.error('❌ Error initializing 3D game:', error);
                const container = document.getElementById('gameGrid');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #ff6b6b;">
                            <h3>❌ Erreur d'initialisation</h3>
                            <p>Le jeu 3D n'a pas pu être initialisé: ${error.message}</p>
                            <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                Rafraîchir la page
                            </button>
                        </div>
                    `;
                }
            }
        });

        // Fullscreen function
        function toggleFullScreen() {
            console.log('🖥️ toggleFullScreen() called');
            
            const gameContainer = document.querySelector('.game-container');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            
            console.log('📦 Game container found:', gameContainer);
            console.log('🔘 Fullscreen button found:', fullscreenBtn);
            
            if (gameContainer.classList.contains('fullscreen')) {
                console.log('📤 Exiting fullscreen mode');
                exitFullScreen();
            } else {
                console.log('📥 Entering fullscreen mode');
                enterFullScreen();
            }
        }

        function enterFullScreen() {
            console.log('📥 enterFullScreen() called');
            
            const gameContainer = document.querySelector('.game-container');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            
            gameContainer.classList.add('fullscreen');
            fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> Sortir';
            
            // Add exit button
            const exitBtn = document.createElement('div');
            exitBtn.className = 'fullscreen-exit';
            exitBtn.innerHTML = '<i class="fas fa-times"></i>';
            exitBtn.onclick = exitFullScreen;
            gameContainer.appendChild(exitBtn);
            
            // Resize 3D canvas for full screen
            const canvas = document.getElementById('threejsCanvas');
            console.log('🎨 Canvas found for fullscreen:', canvas);
            
            if (canvas && game3D && game3D.renderer) {
                // Calculate optimal canvas size for full screen
                const container = gameContainer.querySelector('.game-grid-container');
                const containerRect = container.getBoundingClientRect();
                const maxWidth = Math.min(containerRect.width * 0.9, window.innerWidth * 0.8);
                const maxHeight = Math.min(containerRect.height * 0.9, window.innerHeight * 0.7);
                const canvasSize = Math.min(maxWidth, maxHeight);
                
                console.log('📐 Fullscreen dimensions:', {
                    containerWidth: containerRect.width,
                    containerHeight: containerRect.height,
                    maxWidth: maxWidth,
                    maxHeight: maxHeight,
                    canvasSize: canvasSize
                });
                
                canvas.width = canvasSize;
                canvas.height = canvasSize;
                game3D.renderer.setSize(canvasSize, canvasSize);
                
                // Update camera aspect ratio
                if (game3D.camera) {
                    game3D.camera.aspect = canvasSize / canvasSize;
                    game3D.camera.updateProjectionMatrix();
                    console.log('📷 Camera aspect ratio updated for fullscreen');
                }
                
                // Enhance 3D scene for full screen
                if (game3D.scene) {
                    // Adjust camera position for better view
                    game3D.camera.position.set(0, 0, 18);
                    game3D.camera.lookAt(0, 0, 0);
                    
                    // Enhance lighting for full screen
                    game3D.scene.children.forEach(child => {
                        if (child.type === 'DirectionalLight') {
                            child.intensity = 1.5;
                        } else if (child.type === 'PointLight') {
                            child.intensity = 1.2;
                        }
                    });
                    
                    console.log('🎬 3D scene enhanced for fullscreen');
                }
            } else {
                console.warn('⚠️ Canvas or renderer not available for fullscreen resize');
            }
            
            // Add keyboard shortcuts for full screen
            document.addEventListener('keydown', handleFullScreenKeyboard);
            
            console.log('✅ Entered full screen mode');
        }

        function exitFullScreen() {
            console.log('📤 exitFullScreen() called');
            
            const gameContainer = document.querySelector('.game-container');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            
            gameContainer.classList.remove('fullscreen');
            fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> Plein Écran';
            
            // Remove exit button
            const exitBtn = gameContainer.querySelector('.fullscreen-exit');
            if (exitBtn) {
                exitBtn.remove();
                console.log('❌ Exit button removed');
            }
            
            // Reset 3D canvas size
            const canvas = document.getElementById('threejsCanvas');
            console.log('🎨 Canvas found for exit fullscreen:', canvas);
            
            if (canvas && game3D && game3D.renderer) {
                canvas.width = 500;
                canvas.height = 500;
                game3D.renderer.setSize(500, 500);
                
                // Update camera aspect ratio
                if (game3D.camera) {
                    game3D.camera.aspect = 1;
                    game3D.camera.updateProjectionMatrix();
                    console.log('📷 Camera aspect ratio reset');
                }
                
                // Reset 3D scene to normal mode
                if (game3D.scene) {
                    // Reset camera position
                    game3D.camera.position.set(0, 0, 15);
                    game3D.camera.lookAt(0, 0, 0);
                    
                    // Reset lighting
                    game3D.scene.children.forEach(child => {
                        if (child.type === 'DirectionalLight') {
                            child.intensity = 1.2;
                        } else if (child.type === 'PointLight') {
                            child.intensity = 1;
                        }
                    });
                    
                    console.log('🎬 3D scene reset to normal mode');
                }
            } else {
                console.warn('⚠️ Canvas or renderer not available for fullscreen exit resize');
            }
            
            // Remove keyboard shortcuts
            document.removeEventListener('keydown', handleFullScreenKeyboard);
            
            console.log('✅ Exited full screen mode');
        }

        function handleFullScreenKeyboard(event) {
            switch(event.key) {
                case 'Escape':
                    console.log('⌨️ Escape key pressed - exiting fullscreen');
                    event.preventDefault();
                    exitFullScreen();
                    break;
                case 'F11':
                    console.log('⌨️ F11 key pressed - exiting fullscreen');
                    event.preventDefault();
                    exitFullScreen();
                    break;
                case ' ':
                    console.log('⌨️ Space key pressed - toggling game pause');
                    event.preventDefault();
                    if (game3D) {
                        if (game3D.gameRunning && !game3D.paused) {
                            game3D.pauseGame();
                        } else if (game3D.gameRunning && game3D.paused) {
                            game3D.startGame();
                        }
                    }
                    break;
                case 'r':
                case 'R':
                    console.log('⌨️ R key pressed - resetting game');
                    event.preventDefault();
                    if (game3D) {
                        game3D.resetGame();
                    }
                    break;
                case 's':
                case 'S':
                    console.log('⌨️ S key pressed - starting game');
                    event.preventDefault();
                    if (game3D && !game3D.gameRunning) {
                        game3D.startGame();
                    }
                    break;
            }
        }

        // Keyboard shortcut for full screen (F11)
        document.addEventListener('keydown', function(event) {
            if (event.key === 'F11') {
                console.log('⌨️ F11 key pressed - toggling fullscreen');
                event.preventDefault();
                toggleFullScreen();
            }
        });
    </script>
</body>
</html>